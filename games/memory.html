<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ§© ×–×™×›×¨×•×Ÿ ×¤×•×¨×™×</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ§©</text></svg>">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Frank+Ruhl+Libre:wght@400;700;900&family=Heebo:wght@300;400;700;900&display=swap');
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Heebo', sans-serif;
      background: linear-gradient(180deg, #fef9ef, #fdf4ff);
      color: #1e1b4b;
      min-height: 100vh;
      display: flex; flex-direction: column; align-items: center;
      padding: 15px;
      overflow-x: hidden;
      transition: transform 0.1s;
    }
    .back-link {
      position: fixed; top: 12px; right: 12px;
      color: #7c3aed; text-decoration: none;
      font-size: 0.85rem; z-index: 100;
      background: #fff; padding: 5px 12px;
      border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h1 {
      font-family: 'Frank Ruhl Libre', serif;
      font-size: clamp(1.6rem, 5vw, 2.2rem);
      color: #7c3aed; text-align: center; margin: 8px 0;
    }
    .stats {
      display: flex; gap: 10px;
      margin: 8px 0 12px;
      font-size: 0.9rem; flex-wrap: wrap; justify-content: center;
    }
    .stat {
      background: #fff; padding: 5px 14px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.06);
    }
    .stat span { color: #7c3aed; font-weight: 700; }
    .streak-stat {
      background: linear-gradient(135deg, #ef4444, #f97316);
      color: #fff; padding: 5px 14px;
      border-radius: 10px; font-weight: 700;
      display: none;
    }
    .streak-stat.active { display: block; animation: streakPop 0.4s ease-out; }
    @keyframes streakPop { 0% { transform: scale(0.7); } 100% { transform: scale(1); } }

    .difficulty-select {
      display: flex; gap: 8px; margin-bottom: 12px;
    }
    .diff-btn {
      font-family: 'Heebo', sans-serif;
      padding: 6px 16px;
      border: 2px solid rgba(124,58,237,0.2);
      background: #fff; color: #7c3aed;
      border-radius: 10px; cursor: pointer;
      font-size: 0.85rem; transition: all 0.3s;
    }
    .diff-btn:hover, .diff-btn.active {
      background: #7c3aed; color: #fff; border-color: #7c3aed;
    }
    .board {
      display: grid; gap: 8px;
      max-width: 500px; width: 100%;
    }
    .board.size-4 { grid-template-columns: repeat(4, 1fr); }
    .board.size-5 { grid-template-columns: repeat(5, 1fr); }
    .board.size-6 { grid-template-columns: repeat(4, 1fr); }
    .card {
      aspect-ratio: 0.85;
      border-radius: 12px;
      cursor: pointer;
      perspective: 800px;
      transition: transform 0.15s;
    }
    .card:hover { transform: scale(1.04); }
    .card-inner {
      width: 100%; height: 100%;
      position: relative;
      transform-style: preserve-3d;
      transition: transform 0.45s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .card.flipped .card-inner, .card.matched .card-inner { transform: rotateY(180deg); }
    .card.matched { animation: matchPop 0.6s ease-out; }
    @keyframes matchPop {
      0% { transform: scale(1); }
      30% { transform: scale(1.15) rotate(3deg); }
      60% { transform: scale(1.08) rotate(-2deg); }
      100% { transform: scale(1); }
    }
    .card-face {
      position: absolute;
      width: 100%; height: 100%;
      backface-visibility: hidden;
      border-radius: 12px;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
    }
    .card-front {
      background: linear-gradient(135deg, #c084fc, #a78bfa);
      border: 2px solid rgba(255,255,255,0.3);
    }
    .card-front::after {
      content: 'ğŸ­';
      font-size: clamp(1.2rem, 4vw, 1.8rem);
      opacity: 0.5;
    }
    .card-back {
      transform: rotateY(180deg);
      background: #fff;
      border: 2px solid #e9d5ff;
      padding: 5px;
    }
    .card-back .emoji {
      font-size: clamp(1.5rem, 5vw, 2.2rem);
      line-height: 1;
    }
    .card-back .label {
      font-size: clamp(0.6rem, 2vw, 0.8rem);
      color: #6b21a8; font-weight: 700;
      margin-top: 3px; text-align: center; line-height: 1.1;
    }
    .card.matched .card-back {
      border-color: #86efac;
      background: linear-gradient(135deg, #f0fdf4, #dcfce7);
      box-shadow: 0 0 12px rgba(34,197,94,0.3);
    }

    /* â•â• Effects â•â• */
    .effect-layer {
      position: fixed; top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none; z-index: 150;
      overflow: hidden;
    }
    .flying-emoji {
      position: absolute; font-size: 2.5rem;
      animation: flyUp 1.5s ease-out forwards;
      pointer-events: none;
    }
    @keyframes flyUp {
      0% { transform: translateY(0) scale(0.3) rotate(0deg); opacity: 1; }
      100% { transform: translateY(var(--fly, -350px)) scale(var(--sc, 1.3)) rotate(var(--rot, 30deg)); opacity: 0; }
    }
    .conf-p {
      position: absolute;
      width: var(--s, 8px); height: var(--s, 8px);
      border-radius: var(--br, 50%);
      background: var(--c);
      animation: confBurst 1s ease-out forwards;
    }
    @keyframes confBurst {
      0% { transform: translate(0,0) scale(1); opacity: 1; }
      100% { transform: translate(var(--tx), var(--ty)) scale(0); opacity: 0; }
    }
    .screen-flash {
      position: fixed; top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none; z-index: 140;
      animation: flashAnim 0.3s ease-out forwards;
    }
    @keyframes flashAnim { 0% { opacity: 0.5; } 100% { opacity: 0; } }
    .match-text {
      position: fixed; z-index: 200;
      font-family: 'Frank Ruhl Libre', serif;
      font-weight: 900; pointer-events: none;
      animation: matchTextAnim 1.2s ease-out forwards;
    }
    @keyframes matchTextAnim {
      0% { transform: translate(-50%, -50%) scale(0) rotate(-15deg); opacity: 0; }
      25% { transform: translate(-50%, -50%) scale(1.5) rotate(5deg); opacity: 1; }
      60% { transform: translate(-50%, -50%) scale(1.2) rotate(-3deg); opacity: 1; }
      100% { transform: translate(-50%, calc(-50% - 60px)) scale(0.8); opacity: 0; }
    }
    .firework-burst { position: fixed; pointer-events: none; z-index: 155; }
    .fw-p {
      position: absolute;
      width: 4px; height: 4px;
      border-radius: 50%;
      animation: fwPop 0.9s ease-out forwards;
    }
    @keyframes fwPop {
      0% { transform: translate(0,0) scale(1.3); opacity: 1; }
      100% { transform: translate(var(--fx), var(--fy)) scale(0); opacity: 0; }
    }
    .star-spin {
      position: fixed; pointer-events: none; z-index: 160;
      font-size: 3rem;
      animation: starSpin 1.2s ease-out forwards;
    }
    @keyframes starSpin {
      0% { transform: translate(-50%,-50%) scale(0) rotate(0deg); opacity: 1; }
      30% { transform: translate(-50%,-50%) scale(1.3) rotate(360deg); opacity: 1; }
      100% { transform: translate(-50%,-50%) scale(0.2) rotate(720deg); opacity: 0; }
    }
    .combo-text {
      position: fixed; top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      font-family: 'Frank Ruhl Libre', serif;
      font-size: clamp(3rem, 12vw, 6rem);
      font-weight: 900; color: #fff;
      text-shadow: 0 0 30px rgba(251,191,36,0.8), 0 0 60px rgba(236,72,153,0.6), 0 5px 15px rgba(0,0,0,0.3);
      pointer-events: none; z-index: 200;
      opacity: 0; display: none;
    }
    .combo-text.active {
      display: block;
      animation: comboShow 1.1s ease-out forwards;
    }
    @keyframes comboShow {
      0% { opacity: 0; transform: translate(-50%, -50%) scale(0.3) rotate(-20deg); }
      25% { opacity: 1; transform: translate(-50%, -50%) scale(1.5) rotate(8deg); }
      50% { transform: translate(-50%, -50%) scale(1.2) rotate(-4deg); }
      100% { opacity: 0; transform: translate(-50%, -50%) scale(1.8); }
    }

    .win-screen {
      position: fixed; top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(255,255,255,0.92);
      display: none; align-items: center; justify-content: center;
      flex-direction: column; z-index: 200; text-align: center; padding: 20px;
    }
    .win-screen.active { display: flex; }
    .win-emoji { font-size: 4rem; animation: bounce 1s ease-in-out infinite; }
    @keyframes bounce { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
    .win-title {
      font-family: 'Frank Ruhl Libre', serif;
      font-size: 2.2rem; color: #7c3aed; margin: 12px 0;
    }
    .win-stats { font-size: 1.1rem; color: #6b7280; margin-bottom: 15px; line-height: 2; }
    .win-btn {
      font-family: 'Heebo', sans-serif;
      padding: 10px 28px; font-size: 1rem;
      border: 2px solid #7c3aed; background: #7c3aed;
      color: #fff; border-radius: 12px; cursor: pointer;
      margin: 4px; transition: all 0.3s;
    }
    .win-btn:hover { background: #6d28d9; }
    .win-btn.secondary { background: #fff; color: #7c3aed; }
  </style>
</head>
<body>

<div class="effect-layer" id="effects"></div>
<div class="combo-text" id="comboText"></div>
<a href="../index.html" class="back-link">â†’ ×—×–×¨×”</a>
<h1>ğŸ§© ×–×™×›×¨×•×Ÿ ×¤×•×¨×™×</h1>
<div class="difficulty-select">
  <button class="diff-btn active" onclick="startGame(4)">×§×œ</button>
  <button class="diff-btn" onclick="startGame(5)">×‘×™× ×•× ×™</button>
  <button class="diff-btn" onclick="startGame(6)">×§×©×”</button>
</div>
<div class="stats">
  <div class="stat">××”×œ×›×™×: <span id="moves">0</span></div>
  <div class="stat">×–×•×’×•×ª: <span id="pairs">0</span>/<span id="totalPairs">8</span></div>
  <div class="stat">â±ï¸ <span id="timer">0:00</span></div>
  <div class="streak-stat" id="streakStat">ğŸ”¥ ×¨×¦×£: 0</div>
</div>
<div class="board size-4" id="board"></div>
<div class="win-screen" id="winScreen">
  <div class="win-emoji">ğŸ†</div>
  <h2 class="win-title">×›×œ ×”×›×‘×•×“!</h2>
  <div class="win-stats" id="winStats"></div>
  <button class="win-btn" onclick="startGame(currentSize)">×©×—×§×• ×©×•×‘!</button>
  <button class="win-btn secondary" onclick="location.href='../index.html'">×—×–×¨×”</button>
</div>

<script>
const CHARACTERS = [
  { emoji: 'ğŸ‘¸', name: '××¡×ª×¨ ×”××œ×›×”' },
  { emoji: 'ğŸ“–', name: '××¨×“×›×™ ×”×¦×“×™×§' },
  { emoji: 'ğŸ‘‘', name: '××—×©×•×¨×•×©' },
  { emoji: 'ğŸ˜ˆ', name: '×”××Ÿ ×”×¨×©×¢' },
  { emoji: 'ğŸ‘°', name: '×•×©×ª×™' },
  { emoji: 'ğŸ—¡ï¸', name: '×—×¨×‘×•× ×' },
  { emoji: 'ğŸ“œ', name: '×”××’×™×œ×”' },
  { emoji: 'ğŸ´', name: '×¡×•×¡ ×”××œ×š' },
  { emoji: 'ğŸ‘¿', name: '×–×¨×©' },
  { emoji: 'ğŸ°', name: '×©×•×©×Ÿ ×”×‘×™×¨×”' },
  { emoji: 'ğŸ­', name: '×ª×—×¤×•×©×ª' },
  { emoji: 'ğŸª', name: '××•×–×Ÿ ×”××Ÿ' },
  { emoji: 'ğŸ“¢', name: '×¨×¢×©×Ÿ' },
  { emoji: 'ğŸ', name: '××©×œ×•×— ×× ×•×ª' },
  { emoji: 'ğŸ·', name: '××©×ª×” ×”×™×™×Ÿ' },
  { emoji: 'ğŸŒ³', name: '×¢×¥ ×”××Ÿ' },
  { emoji: 'ğŸ‘¹', name: '×—××™× ××™ â€” ×”××Ÿ ×©×œ ×”×“×•×¨' },
  { emoji: 'ğŸ‡®ğŸ‡±', name: '××“×™× ×ª ×™×©×¨××œ' },
];

let currentSize = 4, cards = [], flipped = [], matched = 0, moves = 0, timer = null, seconds = 0, locked = false;
let matchStreak = 0;
const effectsEl = document.getElementById('effects');

// â•â• Audio â•â•
let audioCtx = null;
function getAudio() { if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); return audioCtx; }

function playMatchSound(streak) {
  const ctx = getAudio(), now = ctx.currentTime;
  const base = 523.25 + streak * 100;
  [base, base * 1.25, base * 1.5].forEach((freq, i) => {
    const osc = ctx.createOscillator(), gain = ctx.createGain();
    osc.type = streak >= 3 ? 'triangle' : 'sine';
    osc.frequency.value = freq;
    gain.gain.setValueAtTime(0.12 + streak * 0.02, now + i * 0.08);
    gain.gain.exponentialRampToValueAtTime(0.001, now + i * 0.08 + 0.35);
    osc.connect(gain); gain.connect(ctx.destination);
    osc.start(now + i * 0.08); osc.stop(now + i * 0.08 + 0.35);
  });
}

function playMissSound() {
  const ctx = getAudio(), now = ctx.currentTime;
  const osc = ctx.createOscillator(), gain = ctx.createGain();
  osc.type = 'square'; osc.frequency.setValueAtTime(180, now);
  osc.frequency.linearRampToValueAtTime(100, now + 0.2);
  gain.gain.setValueAtTime(0.06, now);
  gain.gain.exponentialRampToValueAtTime(0.001, now + 0.2);
  osc.connect(gain); gain.connect(ctx.destination);
  osc.start(now); osc.stop(now + 0.2);
}

function playVictorySound() {
  const ctx = getAudio(), now = ctx.currentTime;
  [523.25, 659.25, 783.99, 1046.5, 1318.5].forEach((freq, i) => {
    const osc = ctx.createOscillator(), gain = ctx.createGain();
    osc.type = 'triangle'; osc.frequency.value = freq;
    gain.gain.setValueAtTime(0.12, now + i * 0.1);
    gain.gain.exponentialRampToValueAtTime(0.001, now + i * 0.1 + 0.5);
    osc.connect(gain); gain.connect(ctx.destination);
    osc.start(now + i * 0.1); osc.stop(now + i * 0.1 + 0.5);
  });
}

// â•â• Effects Engine â•â•
const FX = {
  emojiRain(emojis, count) {
    for (let i = 0; i < count; i++) {
      const el = document.createElement('div');
      el.className = 'flying-emoji';
      el.textContent = emojis[Math.floor(Math.random() * emojis.length)];
      const fly = -(200 + Math.random() * 400);
      el.style.cssText = `
        left:${Math.random()*90+5}%; bottom:15%;
        font-size:${1.5+Math.random()*2}rem;
        --fly:${fly}px; --sc:${0.8+Math.random()}; --rot:${Math.random()*60-30}deg;
        animation-delay:${Math.random()*0.6}s;
      `;
      effectsEl.appendChild(el);
      setTimeout(() => el.remove(), 2200);
    }
  },

  confettiBurst(x, y, count) {
    const colors = ['#fbbf24','#ec4899','#7c3aed','#3b82f6','#22c55e','#ef4444','#f97316'];
    for (let i = 0; i < count; i++) {
      const p = document.createElement('div');
      p.className = 'conf-p';
      const angle = (i / count) * Math.PI * 2 + Math.random() * 0.5;
      const dist = 60 + Math.random() * 150;
      p.style.cssText = `
        left:${x}px; top:${y}px;
        --c:${colors[Math.floor(Math.random()*colors.length)]};
        --s:${Math.random()*8+4}px; --br:${Math.random()>0.5?'50%':'2px'};
        --tx:${Math.cos(angle)*dist}px; --ty:${Math.sin(angle)*dist}px;
      `;
      effectsEl.appendChild(p);
      setTimeout(() => p.remove(), 1200);
    }
  },

  firework(x, y, big) {
    const fw = document.createElement('div');
    fw.className = 'firework-burst';
    fw.style.left = x + 'px'; fw.style.top = y + 'px';
    const colors = ['#fbbf24','#ec4899','#7c3aed','#22c55e','#ef4444','#f97316'];
    const count = big ? 40 : 24;
    const dist = big ? 90 : 55;
    for (let i = 0; i < count; i++) {
      const p = document.createElement('div');
      p.className = 'fw-p';
      const angle = (i / count) * Math.PI * 2;
      const d = dist + Math.random() * dist * 0.4;
      p.style.cssText = `background:${colors[i%colors.length]}; --fx:${Math.cos(angle)*d}px; --fy:${Math.sin(angle)*d}px;`;
      fw.appendChild(p);
    }
    effectsEl.appendChild(fw);
    setTimeout(() => fw.remove(), 1200);
  },

  flash(color) {
    const el = document.createElement('div');
    el.className = 'screen-flash';
    el.style.background = color;
    effectsEl.appendChild(el);
    setTimeout(() => el.remove(), 400);
  },

  matchText(text, opts = {}) {
    const el = document.createElement('div');
    el.className = 'match-text';
    el.textContent = text;
    el.style.cssText = `
      left:${opts.x || '50%'}; top:${opts.y || '45%'};
      font-size:${opts.size || 'clamp(1.8rem, 6vw, 3rem)'};
      color:${opts.color || '#fbbf24'};
      text-shadow: 0 3px 15px rgba(0,0,0,0.3);
    `;
    effectsEl.appendChild(el);
    setTimeout(() => el.remove(), 1500);
  },

  starSpin(count) {
    for (let i = 0; i < count; i++) {
      const el = document.createElement('div');
      el.className = 'star-spin';
      el.textContent = ['â­','ğŸŒŸ','âœ¨','ğŸ’«'][Math.floor(Math.random()*4)];
      el.style.cssText = `left:${20+Math.random()*60}%; top:${20+Math.random()*60}%; animation-delay:${i*0.12}s;`;
      effectsEl.appendChild(el);
      setTimeout(() => el.remove(), 1500);
    }
  },

  shake(intensity) {
    const dur = 250 + intensity * 80;
    const str = 2 + intensity * 3;
    let start = null;
    function frame(time) {
      if (!start) start = time;
      const elapsed = time - start;
      if (elapsed < dur) {
        const decay = 1 - elapsed / dur;
        document.body.style.transform = `translate(${(Math.random()-0.5)*str*decay*2}px, ${(Math.random()-0.5)*str*decay*2}px)`;
        requestAnimationFrame(frame);
      } else { document.body.style.transform = ''; }
    }
    requestAnimationFrame(frame);
  },

  showCombo(streak) {
    const el = document.getElementById('comboText');
    const texts = { 2:'!××¦×•×™×Ÿ', 3:'ğŸ”¥ ×¨×¦×£!', 4:'ğŸ’¥ ×¡×•×¤×¨!', 5:'âš¡ MEGA!' };
    el.textContent = texts[Math.min(streak, 5)] || `ğŸ”¥ x${streak}!`;
    el.classList.remove('active');
    void el.offsetWidth;
    el.classList.add('active');
    setTimeout(() => el.classList.remove('active'), 1200);
  }
};

// â•â• Match Effects by Streak â•â•
function triggerMatchEffects(streak, cardRect) {
  const cx = cardRect.left + cardRect.width / 2;
  const cy = cardRect.top + cardRect.height / 2;
  const wx = window.innerWidth;
  const wy = window.innerHeight;

  playMatchSound(streak);
  FX.flash('rgba(34,197,94,0.2)');
  FX.confettiBurst(cx, cy, 25 + streak * 8);
  FX.emojiRain(['â­','ğŸ‰','âœ¨','ğŸ‘‘','ğŸ­'], 4 + streak * 2);

  if (streak >= 2) {
    FX.showCombo(streak);
    FX.firework(wx * 0.3, wy * 0.3);
    FX.shake(1);
    FX.matchText('!× ×›×•×Ÿ', { color: '#22c55e' });
  }
  if (streak >= 3) {
    FX.starSpin(4);
    setTimeout(() => FX.firework(wx * 0.7, wy * 0.4, true), 200);
    FX.emojiRain(['ğŸ”¥','ğŸ’¥','âš¡','ğŸŒŸ'], 8);
  }
  if (streak >= 4) {
    FX.shake(2);
    FX.matchText('!!!MEGA', { color: '#ec4899', size: 'clamp(2.5rem, 8vw, 4rem)', y: '35%' });
    for (let i = 0; i < 3; i++) {
      setTimeout(() => FX.firework(Math.random()*wx, Math.random()*wy*0.5, true), i * 150);
    }
  }
}

// â•â• Game Logic â•â•
function startGame(size) {
  currentSize = size;
  const pairsMap = { 4: 8, 5: 10, 6: 12 };
  const totalPairsCount = pairsMap[size];
  matched = 0; moves = 0; seconds = 0; flipped = []; locked = false; matchStreak = 0;
  document.getElementById('moves').textContent = '0';
  document.getElementById('pairs').textContent = '0';
  document.getElementById('totalPairs').textContent = totalPairsCount;
  document.getElementById('timer').textContent = '0:00';
  document.getElementById('winScreen').classList.remove('active');
  document.getElementById('streakStat').classList.remove('active');
  document.querySelectorAll('.diff-btn').forEach((b, i) => b.classList.toggle('active', [4,5,6][i] === size));
  const board = document.getElementById('board');
  board.className = `board size-${size}`;
  const selected = CHARACTERS.slice(0, totalPairsCount);
  const deck = [...selected, ...selected];
  shuffle(deck);
  cards = deck;
  board.innerHTML = '';
  deck.forEach((char, i) => {
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `
      <div class="card-inner">
        <div class="card-face card-front"></div>
        <div class="card-face card-back">
          <span class="emoji">${char.emoji}</span>
          <span class="label">${char.name}</span>
        </div>
      </div>`;
    card.addEventListener('click', () => flipCard(card, i));
    board.appendChild(card);
  });
  if (timer) clearInterval(timer);
  timer = setInterval(() => {
    seconds++;
    document.getElementById('timer').textContent = `${Math.floor(seconds/60)}:${(seconds%60).toString().padStart(2,'0')}`;
  }, 1000);
}

function flipCard(cardEl, index) {
  if (locked || cardEl.classList.contains('flipped') || cardEl.classList.contains('matched') || flipped.length >= 2) return;
  cardEl.classList.add('flipped');
  flipped.push({ el: cardEl, index });
  if (flipped.length === 2) {
    moves++;
    document.getElementById('moves').textContent = moves;
    locked = true;
    const [a, b] = flipped;
    if (cards[a.index].emoji === cards[b.index].emoji) {
      // MATCH!
      matchStreak++;
      setTimeout(() => {
        a.el.classList.add('matched');
        b.el.classList.add('matched');
        matched++;
        document.getElementById('pairs').textContent = matched;

        // Streak display
        if (matchStreak >= 2) {
          const ss = document.getElementById('streakStat');
          ss.textContent = `ğŸ”¥ ×¨×¦×£: ${matchStreak}`;
          ss.classList.remove('active');
          void ss.offsetWidth;
          ss.classList.add('active');
        }

        // CRAZY EFFECTS!
        const rect = a.el.getBoundingClientRect();
        triggerMatchEffects(matchStreak, rect);

        flipped = []; locked = false;
        const totalPairsCount = { 4: 8, 5: 10, 6: 12 }[currentSize];
        if (matched === totalPairsCount) { clearInterval(timer); showWin(totalPairsCount); }
      }, 350);
    } else {
      // No match
      matchStreak = 0;
      document.getElementById('streakStat').classList.remove('active');
      playMissSound();
      setTimeout(() => {
        a.el.classList.remove('flipped');
        b.el.classList.remove('flipped');
        flipped = []; locked = false;
      }, 700);
    }
  }
}

function showWin(totalPairsCount) {
  const t = `${Math.floor(seconds/60)}:${(seconds%60).toString().padStart(2,'0')}`;
  let stars = moves <= totalPairsCount * 2 ? 'â­â­â­' : moves <= totalPairsCount * 3.5 ? 'â­â­' : 'â­';
  document.getElementById('winStats').innerHTML = `${stars}<br>â±ï¸ ${t}<br>ğŸ¯ ${moves} ××”×œ×›×™×`;
  document.getElementById('winScreen').classList.add('active');

  // VICTORY CELEBRATION!
  playVictorySound();
  for (let i = 0; i < 8; i++) {
    setTimeout(() => FX.firework(
      Math.random() * window.innerWidth,
      Math.random() * window.innerHeight * 0.6,
      i % 2 === 0
    ), i * 250);
  }
  FX.emojiRain(['ğŸ‰','ğŸ†','â­','ğŸ­','ğŸ‘‘','ğŸŠ','âœ¨','ğŸŒŸ'], 25);
  FX.starSpin(6);
  FX.matchText('!×›×œ ×”×›×‘×•×“', { size: 'clamp(2.5rem, 8vw, 5rem)', color: '#fbbf24', y: '30%' });
}

function shuffle(a) { for (let i = a.length-1; i > 0; i--) { const j = Math.floor(Math.random()*(i+1)); [a[i],a[j]] = [a[j],a[i]]; } }
startGame(4);
</script>
</body>
</html>
