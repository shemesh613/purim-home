<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>â“ ×—×™×“×•×Ÿ ××’×™×œ×ª ××¡×ª×¨</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>â“</text></svg>">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Frank+Ruhl+Libre:wght@400;700;900&family=Heebo:wght@300;400;700;900&display=swap');
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Heebo', sans-serif;
      background: linear-gradient(180deg, #fef9ef, #ede9fe);
      color: #1e1b4b;
      min-height: 100vh;
      display: flex; flex-direction: column; align-items: center;
      padding: 15px;
      overflow-x: hidden;
    }
    .back-link {
      position: fixed; top: 12px; right: 12px;
      color: #7c3aed; text-decoration: none;
      font-size: 0.85rem; z-index: 100;
      background: #fff; padding: 5px 12px;
      border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h1 {
      font-family: 'Frank Ruhl Libre', serif;
      font-size: clamp(1.6rem, 5vw, 2.2rem);
      color: #7c3aed; text-align: center; margin: 8px 0 5px;
    }
    .progress-bar {
      width: 100%; max-width: 600px; height: 10px;
      background: #e9d5ff; border-radius: 5px;
      margin: 10px 0; overflow: hidden;
    }
    .progress-fill {
      height: 100%; border-radius: 5px;
      background: linear-gradient(90deg, #7c3aed, #ec4899, #fbbf24);
      background-size: 200% 100%;
      animation: progShimmer 2s linear infinite;
      transition: width 0.5s;
    }
    @keyframes progShimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
    .top-bar {
      display: flex; gap: 15px; align-items: center;
      margin-bottom: 12px; font-size: 0.95rem;
    }
    .score-box {
      background: linear-gradient(135deg, #fbbf24, #f97316);
      color: #fff; padding: 5px 16px; border-radius: 10px;
      font-weight: 900; font-size: 1.1rem;
      box-shadow: 0 3px 10px rgba(251,191,36,0.3);
      transition: transform 0.3s;
    }
    .score-box.bump { animation: scoreBump 0.4s ease-out; }
    @keyframes scoreBump { 0% { transform: scale(1); } 50% { transform: scale(1.3); } 100% { transform: scale(1); } }
    .streak-box {
      background: #fff; padding: 5px 14px; border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.06);
      display: none;
    }
    .streak-box.active { display: block; animation: streakPop 0.3s ease-out; }
    @keyframes streakPop { 0% { transform: scale(0.8); } 100% { transform: scale(1); } }

    .question-card {
      background: #fff; border-radius: 20px;
      padding: 25px; max-width: 600px; width: 100%;
      text-align: center;
      box-shadow: 0 4px 20px rgba(0,0,0,0.06);
      position: relative; overflow: hidden;
    }
    .question-emoji { font-size: 3rem; margin-bottom: 10px; }
    .question-text {
      font-family: 'Frank Ruhl Libre', serif;
      font-size: clamp(1.1rem, 3.5vw, 1.5rem);
      color: #1e1b4b; line-height: 1.6; margin-bottom: 20px;
    }
    .options {
      display: grid; grid-template-columns: 1fr 1fr; gap: 10px;
    }
    @media (max-width: 500px) { .options { grid-template-columns: 1fr; } }
    .option-btn {
      font-family: 'Heebo', sans-serif;
      font-size: 1rem; padding: 12px 16px;
      border: 2px solid #e9d5ff; background: #faf5ff;
      color: #4c1d95; border-radius: 14px;
      cursor: pointer; transition: all 0.3s;
      text-align: center; font-weight: 500;
    }
    .option-btn:hover:not(.disabled) {
      border-color: #7c3aed; background: #ede9fe;
      transform: translateY(-2px);
    }
    .option-btn.correct {
      border-color: #22c55e; background: #dcfce7; color: #166534;
      animation: correctBounce 0.5s ease-out;
    }
    @keyframes correctBounce { 0% { transform: scale(1); } 40% { transform: scale(1.08); } 100% { transform: scale(1); } }
    .option-btn.wrong {
      border-color: #ef4444; background: #fef2f2; color: #991b1b;
      animation: wrongShake 0.4s ease-out;
    }
    @keyframes wrongShake { 0%,100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 75% { transform: translateX(10px); } }
    .option-btn.disabled { pointer-events: none; opacity: 0.5; }
    .option-btn.disabled.correct { opacity: 1; }

    .feedback {
      margin-top: 15px; font-size: 1rem;
      min-height: 2em; line-height: 1.5;
      padding: 10px; border-radius: 12px;
    }
    .feedback.correct-fb { background: #dcfce7; color: #166534; }
    .feedback.wrong-fb { background: #fef2f2; color: #991b1b; }

    .next-btn {
      font-family: 'Heebo', sans-serif;
      padding: 10px 30px; border: none;
      background: linear-gradient(135deg, #7c3aed, #ec4899);
      color: #fff; border-radius: 12px;
      cursor: pointer; font-size: 1rem; font-weight: 700;
      margin-top: 12px; display: none;
      transition: all 0.3s;
    }
    .next-btn.visible { display: inline-block; }
    .next-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(124,58,237,0.3); }

    /* â•â• CRAZY EFFECTS â•â• */
    .effect-layer {
      position: fixed; top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none; z-index: 100;
      overflow: hidden;
    }
    .flying-emoji {
      position: absolute; font-size: 3rem;
      animation: flyUp 1.5s ease-out forwards;
      pointer-events: none;
    }
    @keyframes flyUp {
      0% { transform: translateY(0) scale(0.5) rotate(0deg); opacity: 1; }
      100% { transform: translateY(-300px) scale(1.5) rotate(var(--rot, 30deg)); opacity: 0; }
    }
    .confetti-burst .conf-p {
      position: absolute; width: var(--s, 8px); height: var(--s, 8px);
      border-radius: 50%; background: var(--c);
      animation: confBurst 1s ease-out forwards;
    }
    @keyframes confBurst {
      0% { transform: translate(0,0) scale(1); opacity: 1; }
      100% { transform: translate(var(--tx), var(--ty)) scale(0); opacity: 0; }
    }
    .screen-flash {
      position: fixed; top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none; z-index: 99;
      animation: screenFlash 0.3s ease-out forwards;
    }
    @keyframes screenFlash {
      0% { opacity: 0.5; } 100% { opacity: 0; }
    }
    .score-float {
      position: fixed; z-index: 101;
      font-size: 2rem; font-weight: 900;
      color: #fbbf24; pointer-events: none;
      animation: scoreFloat 1s ease-out forwards;
      text-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }
    @keyframes scoreFloat {
      0% { transform: translateY(0) scale(1); opacity: 1; }
      100% { transform: translateY(-80px) scale(1.5); opacity: 0; }
    }
    .wrong-x {
      position: fixed; z-index: 101;
      font-size: 5rem; pointer-events: none;
      animation: wrongX 0.6s ease-out forwards;
    }
    @keyframes wrongX {
      0% { transform: scale(0) rotate(0deg); opacity: 1; }
      50% { transform: scale(1.2) rotate(10deg); opacity: 1; }
      100% { transform: scale(0.8) rotate(-5deg); opacity: 0; }
    }
    .firework-burst {
      position: fixed; pointer-events: none; z-index: 100;
    }
    .fw-p {
      position: absolute; width: 4px; height: 4px;
      border-radius: 50%;
      animation: fwPop 0.8s ease-out forwards;
    }
    @keyframes fwPop {
      0% { transform: translate(0,0) scale(1); opacity: 1; }
      100% { transform: translate(var(--fx), var(--fy)) scale(0); opacity: 0; }
    }

    /* Results */
    .results {
      text-align: center; display: none;
      max-width: 600px; width: 100%;
      background: #fff; border-radius: 20px;
      padding: 30px; box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    }
    .results.active { display: block; }
    .results-emoji { font-size: 4rem; margin: 15px 0; }
    .results-title { font-family: 'Frank Ruhl Libre', serif; font-size: 2.2rem; color: #7c3aed; }
    .results-score { font-size: 1.3rem; color: #6b7280; margin: 10px 0; }
    .results-message { font-size: 1rem; color: #9ca3af; margin-bottom: 20px; }
    .results-btns { display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; }
    .res-btn {
      font-family: 'Heebo', sans-serif;
      padding: 10px 25px; border: none; border-radius: 12px;
      cursor: pointer; font-size: 0.95rem; font-weight: 700;
      transition: all 0.3s;
    }
    .res-btn:hover { transform: translateY(-2px); }
    .res-btn.primary { background: #7c3aed; color: #fff; }
    .res-btn.share { background: #25d366; color: #fff; }
    .res-btn.home { background: #f3f4f6; color: #4b5563; }
  </style>
</head>
<body>

<div class="effect-layer" id="effects"></div>
<a href="../index.html" class="back-link">â†’ ×—×–×¨×”</a>
<h1>â“ ×—×™×“×•×Ÿ ××’×™×œ×ª ××¡×ª×¨</h1>
<div class="progress-bar"><div class="progress-fill" id="progress" style="width:0%"></div></div>
<div class="top-bar">
  <span id="qNum" style="color:#9ca3af;">×©××œ×” 1/20</span>
  <div class="score-box" id="scoreBox">ğŸ† 0</div>
  <div class="streak-box" id="streakBox">ğŸ”¥ ×¨×¦×£: 0</div>
</div>

<div class="question-card" id="questionCard">
  <div class="question-emoji" id="qEmoji">ğŸ“œ</div>
  <div class="question-text" id="qText">×˜×•×¢×Ÿ...</div>
  <div class="options" id="options"></div>
  <div class="feedback" id="feedback"></div>
  <button class="next-btn" id="nextBtn" onclick="nextQuestion()">×”×©××œ×” ×”×‘××” â†</button>
</div>

<div class="results" id="results">
  <div class="results-emoji" id="resEmoji">ğŸ†</div>
  <h2 class="results-title" id="resTitle">×¡×™×™××ª×!</h2>
  <div class="results-score" id="resScore"></div>
  <div class="results-message" id="resMsg"></div>
  <div class="results-btns">
    <button class="res-btn primary" onclick="startQuiz()">ğŸ”„ ×©×—×§×• ×©×•×‘!</button>
    <button class="res-btn share" onclick="shareResult()">ğŸ“± ×©×ª×¤×•</button>
    <button class="res-btn home" onclick="location.href='../index.html'">ğŸ  ×—×–×¨×”</button>
  </div>
</div>

<script>
const QUESTIONS = [
  { q: "××™ ×”×™×” ×”××œ×š ×‘×¡×™×¤×•×¨ ××’×™×œ×ª ××¡×ª×¨?", options: ["×©×œ××”", "××—×©×•×¨×•×©", "×“×•×“", "× ×‘×•×›×“× ××¦×¨"], correct: 1, emoji: "ğŸ‘‘", fact: "××—×©×•×¨×•×© ××œ×š ×¢×œ 127 ××“×™× ×•×ª!" },
  { q: "××” ×©× ×”×¢×™×¨ ×”×‘×™×¨×” ×©×œ ××—×©×•×¨×•×©?", options: ["×™×¨×•×©×œ×™×", "×‘×‘×œ", "×©×•×©×Ÿ", "×¨×•××"], correct: 2, emoji: "ğŸ°", fact: "×©×•×©×Ÿ ×”×‘×™×¨×” ×”×™×™×ª×” ×‘×¤×¨×¡ â€” ××™×¨××Ÿ ×©×œ ×”×™×•×!" },
  { q: "××™ ×”×™×ª×” ×”××œ×›×” ×œ×¤× ×™ ××¡×ª×¨?", options: ["×¨×—×œ", "×•×©×ª×™", "××¨×™×", "×©×¨×”"], correct: 1, emoji: "ğŸ‘°", fact: "×•×©×ª×™ ×¡×™×¨×‘×” ×œ×”×•×¤×™×¢ ×‘××©×ª×” ×”××œ×š!" },
  { q: "××™ ×”×™×” ×“×•×“ (××¤×•×˜×¨×•×¤×•×¡) ×©×œ ××¡×ª×¨?", options: ["×”××Ÿ", "×—×¨×‘×•× ×", "××¨×“×›×™", "×‘×™×’×ª×Ÿ"], correct: 2, emoji: "ğŸ§”", fact: "××¨×“×›×™ ×”×™×” ×‘×Ÿ ×“×•×“×” ×•××¤×•×˜×¨×•×¤×•×¡ ×©×œ×”" },
  { q: "×œ××” ×”××Ÿ ×¨×¦×” ×œ×”×©××™×“ ××ª ×”×™×”×•×“×™×?", options: ["×›×™ ×”×™×• ×¢×©×™×¨×™×", "×›×™ ××¨×“×›×™ ×œ× ×”×©×ª×—×•×•×” ×œ×•", "×›×™ ×’× ×‘×• ××× ×•", "×›×™ ×”×•× ×©× × ××ª ××¡×ª×¨"], correct: 1, emoji: "ğŸ˜ˆ", fact: "××¨×“×›×™ ×¡×™×¨×‘ ×œ×”×©×ª×—×•×•×ª ×›×™ ×”×©×ª×—×•×•×™×” ×©×™×™×›×ª ×¨×§ ×œ×”'!" },
  { q: "×›××” ×™××™× ×¦××” ××¡×ª×¨?", options: ["×™×•× ××—×“", "×©×œ×•×©×” ×™××™×", "×©×‘×¢×” ×™××™×", "××¨×‘×¢×™× ×™×•×"], correct: 1, emoji: "ğŸ™", fact: "××¡×ª×¨ ×‘×™×§×©×” ××›×œ ×”×™×”×•×“×™× ×œ×¦×•× 3 ×™××™×!" },
  { q: "××” ×”××©××¢×•×ª ×©×œ ×”××™×œ×” '×¤×•×¨×™×'?", options: ["×—×’", "×’×•×¨×œ", "×©××—×”", "× ×¡"], correct: 1, emoji: "ğŸ²", fact: "'×¤×•×¨' = ×’×•×¨×œ! ×”××Ÿ ×”×¤×™×œ ×’×•×¨×œ×•×ª!" },
  { q: "××” ××¡×ª×¨ ×”×›×™× ×” ×œ××œ×š ×•×œ×”××Ÿ?", options: ["××©×—×§", "××¡×™×‘×”", "××©×ª×” ×™×™×Ÿ", "××ª× ×•×ª"], correct: 2, emoji: "ğŸ·", fact: "××¡×ª×¨ ×”×–××™× ×” ××•×ª× ×œ×©× ×™ ××©×ª××•×ª!" },
  { q: "××™ ×’×™×œ×” ××ª ×”××–×™××” × ×’×“ ×”××œ×š?", options: ["××¡×ª×¨", "×”××Ÿ", "××¨×“×›×™", "×—×¨×‘×•× ×"], correct: 2, emoji: "ğŸ•µï¸", fact: "××¨×“×›×™ ×©××¢ ×©×¨×•×¦×™× ×œ×”×¨×•×’ ××ª ×”××œ×š!" },
  { q: "××” ×œ× ×”×¦×œ×™×— ×”××œ×š ×œ×¢×©×•×ª ×‘××•×ª×• ×œ×™×œ×”?", options: ["×œ××›×•×œ", "×œ×™×©×•×Ÿ", "×œ×“×‘×¨", "×œ×œ×›×ª"], correct: 1, emoji: "ğŸŒ™", fact: "×œ×™×œ×” ××—×“ ×”××œ×š ×œ× ×™×©×Ÿ â€” ×•×–×” ×©×™× ×” ×”×›×œ!" },
  { q: "××” ×—×©×‘ ×”××Ÿ ×©×”××œ×š ×¨×•×¦×” ×œ×¢×©×•×ª ×œ×•?", options: ["×œ×”×¢× ×™×©", "×œ×›×‘×“ ××•×ª×•", "×œ×’×¨×©", "×œ×”×¤×•×š ×œ×¢×‘×“"], correct: 1, emoji: "ğŸ¤”", fact: "×”××Ÿ ×—×©×‘ ×©×”×•× ×”××™×© â€” ××‘×œ ×–×” ×”×™×” ××¨×“×›×™!" },
  { q: "××” ×§×¨×” ×œ×”××Ÿ ×‘×¡×•×£?", options: ["×‘×¨×—", "× ×ª×œ×” ×¢×œ ×”×¢×¥ ×©×”×›×™×Ÿ", "×”×œ×š ×œ×›×œ×", "×”×¤×š ×œ×™×”×•×“×™"], correct: 1, emoji: "âš–ï¸", fact: "×•× ×”×¤×•×š ×”×•×! ×”×¢×¥ ×©×”×›×™×Ÿ ×œ××¨×“×›×™ ×”×¤×š ×œ×©×œ×•!" },
  { q: "×›××” ×‘× ×™× ×”×™×• ×œ×”××Ÿ?", options: ["3", "5", "7", "10"], correct: 3, emoji: "ğŸ‘¨â€ğŸ‘¦", fact: "10 ×‘× ×™×! ×©××•×ª×™×”× × ×§×¨××™× ×‘× ×©×™××” ××—×ª!" },
  { q: "××™ ×¡×™×¤×¨ ×œ××œ×š ×¢×œ ×¢×¥ ×”××Ÿ?", options: ["××¡×ª×¨", "×—×¨×‘×•× ×", "××¨×“×›×™", "×•×©×ª×™"], correct: 1, emoji: "ğŸ—¡ï¸", fact: "×—×¨×‘×•× × ×××¨: '×”× ×” ×”×¢×¥ ×¢×•××“ ×‘×‘×™×ª ×”××Ÿ!'" },
  { q: "××” × ×•×”×’×™× ×œ××›×•×œ ×‘×¤×•×¨×™×?", options: ["××¦×•×ª", "×¡×•×¤×’× ×™×•×ª", "××•×–× ×™ ×”××Ÿ", "×—×œ×”"], correct: 2, emoji: "ğŸª", fact: "××•×–× ×™ ×”××Ÿ â€” ××©×•×œ×©×•×ª ×¢× ××™×œ×•×™!" },
  { q: "×›××” ××¦×•×•×ª ×™×© ×‘×¤×•×¨×™×?", options: ["2", "3", "4", "5"], correct: 2, emoji: "ğŸ“‹", fact: "××’×™×œ×”, ××©×œ×•×— ×× ×•×ª, ××ª× ×•×ª ×œ××‘×™×•× ×™×, ×¡×¢×•×“×”!" },
  { q: "××ª×™ ×§×•×¨××™× ××ª ×”××’×™×œ×”?", options: ["×‘×‘×•×§×¨ ×‘×œ×‘×“", "×‘×¢×¨×‘ ×•×‘×‘×•×§×¨", "×‘×¦×”×¨×™×™×", "×¨×§ ×‘×©×‘×ª"], correct: 1, emoji: "ğŸ“–", fact: "×§×•×¨××™× ×¤×¢××™×™× â€” ×‘×¢×¨×‘ ×•×‘×‘×•×§×¨!" },
  { q: "×‘××™×–×” ×—×•×“×© ×—×œ ×¤×•×¨×™×?", options: ["× ×™×¡×Ÿ", "××“×¨", "×ª×©×¨×™", "×›×¡×œ×•"], correct: 1, emoji: "ğŸ“…", fact: "××©× ×›× ×¡ ××“×¨ ××¨×‘×™×Ÿ ×‘×©××—×”!" },
  { q: "××” ×©× ××©×ª×• ×©×œ ×”××Ÿ?", options: ["×•×©×ª×™", "××¡×ª×¨", "×–×¨×©", "××¨×™×"], correct: 2, emoji: "ğŸ‘¿", fact: "×–×¨×© ×™×¢×¦×” ×œ×”×›×™×Ÿ ×¢×¥ ×’×‘×•×” 50 ×××”!" },
  { q: "××” ×”××©××¢×•×ª ×©×œ '×•× ×”×¤×•×š ×”×•×'?", options: ["×”×›×œ ×”×ª×”×¤×š!", "× ×’××¨", "×”×ª×—×™×œ", "× ×©××¨"], correct: 0, emoji: "ğŸ”„", fact: "××™ ×©×¨×¦×” ×œ×”×©××™×“ â€” × ×©××“! ××™ ×©×”×™×” ×‘×¡×›× ×” â€” × ×™×¦×œ!" }
];

let currentQ = 0, score = 0, streak = 0, maxStreak = 0, answered = false, shuffledQ = [];
const effectsEl = document.getElementById('effects');

// â•â• Audio Context â•â•
let audioCtx = null;
function getAudio() { if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); return audioCtx; }

function playCorrectSound() {
  const ctx = getAudio(), now = ctx.currentTime;
  [523.25, 659.25, 783.99].forEach((freq, i) => {
    const osc = ctx.createOscillator(), gain = ctx.createGain();
    osc.type = 'sine'; osc.frequency.value = freq;
    gain.gain.setValueAtTime(0.15, now + i * 0.1);
    gain.gain.exponentialRampToValueAtTime(0.001, now + i * 0.1 + 0.3);
    osc.connect(gain); gain.connect(ctx.destination);
    osc.start(now + i * 0.1); osc.stop(now + i * 0.1 + 0.3);
  });
}

function playWrongSound() {
  const ctx = getAudio(), now = ctx.currentTime;
  const osc = ctx.createOscillator(), gain = ctx.createGain();
  osc.type = 'square'; osc.frequency.setValueAtTime(200, now);
  osc.frequency.linearRampToValueAtTime(100, now + 0.3);
  gain.gain.setValueAtTime(0.1, now);
  gain.gain.exponentialRampToValueAtTime(0.001, now + 0.3);
  osc.connect(gain); gain.connect(ctx.destination);
  osc.start(now); osc.stop(now + 0.3);
}

// â•â• Visual Effects â•â•
function spawnFlyingEmojis(emojis, count) {
  for (let i = 0; i < count; i++) {
    const el = document.createElement('div');
    el.className = 'flying-emoji';
    el.textContent = emojis[Math.floor(Math.random() * emojis.length)];
    el.style.cssText = `left:${Math.random()*80+10}%; bottom:20%; --rot:${Math.random()*60-30}deg; animation-delay:${Math.random()*0.5}s;`;
    effectsEl.appendChild(el);
    setTimeout(() => el.remove(), 2000);
  }
}

function spawnConfettiBurst(x, y) {
  const colors = ['#fbbf24','#ec4899','#7c3aed','#3b82f6','#22c55e','#ef4444'];
  for (let i = 0; i < 30; i++) {
    const p = document.createElement('div');
    p.className = 'conf-p';
    const angle = (i / 30) * Math.PI * 2;
    const dist = 60 + Math.random() * 100;
    p.style.cssText = `
      left:${x}px; top:${y}px;
      --c:${colors[Math.floor(Math.random()*colors.length)]};
      --s:${Math.random()*8+4}px;
      --tx:${Math.cos(angle)*dist}px;
      --ty:${Math.sin(angle)*dist}px;
    `;
    effectsEl.appendChild(p);
    setTimeout(() => p.remove(), 1200);
  }
}

function spawnFirework(x, y) {
  const fw = document.createElement('div');
  fw.className = 'firework-burst';
  fw.style.left = x + 'px'; fw.style.top = y + 'px';
  const colors = ['#fbbf24','#ec4899','#7c3aed','#22c55e','#f97316'];
  for (let i = 0; i < 24; i++) {
    const p = document.createElement('div');
    p.className = 'fw-p';
    const angle = (i / 24) * Math.PI * 2;
    const dist = 30 + Math.random() * 50;
    p.style.cssText = `background:${colors[i%colors.length]}; --fx:${Math.cos(angle)*dist}px; --fy:${Math.sin(angle)*dist}px;`;
    fw.appendChild(p);
  }
  effectsEl.appendChild(fw);
  setTimeout(() => fw.remove(), 1000);
}

function spawnScoreFloat(points) {
  const el = document.createElement('div');
  el.className = 'score-float';
  el.textContent = `+${points}`;
  el.style.left = '50%'; el.style.top = '40%';
  el.style.transform = 'translateX(-50%)';
  effectsEl.appendChild(el);
  setTimeout(() => el.remove(), 1000);
}

function flashScreen(color) {
  const el = document.createElement('div');
  el.className = 'screen-flash';
  el.style.background = color;
  effectsEl.appendChild(el);
  setTimeout(() => el.remove(), 400);
}

function spawnWrongX() {
  const el = document.createElement('div');
  el.className = 'wrong-x';
  el.textContent = 'âŒ';
  el.style.left = '50%'; el.style.top = '40%';
  el.style.transform = 'translateX(-50%)';
  effectsEl.appendChild(el);
  setTimeout(() => el.remove(), 700);
}

// â•â• Game Logic â•â•
function shuffle(a) { const b=[...a]; for(let i=b.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[b[i],b[j]]=[b[j],b[i]];} return b; }

function startQuiz() {
  shuffledQ = shuffle(QUESTIONS);
  currentQ = 0; score = 0; streak = 0; maxStreak = 0; answered = false;
  document.getElementById('results').classList.remove('active');
  document.getElementById('questionCard').style.display = 'block';
  document.getElementById('scoreBox').textContent = 'ğŸ† 0';
  document.getElementById('streakBox').classList.remove('active');
  showQuestion();
}

function showQuestion() {
  const q = shuffledQ[currentQ]; answered = false;
  document.getElementById('progress').style.width = `${(currentQ/shuffledQ.length)*100}%`;
  document.getElementById('qNum').textContent = `×©××œ×” ${currentQ+1}/${shuffledQ.length}`;
  document.getElementById('qEmoji').textContent = q.emoji;
  document.getElementById('qText').textContent = q.q;
  document.getElementById('feedback').textContent = '';
  document.getElementById('feedback').className = 'feedback';
  document.getElementById('nextBtn').classList.remove('visible');

  const optionsEl = document.getElementById('options');
  optionsEl.innerHTML = '';
  q.options.forEach((opt, i) => {
    const btn = document.createElement('button');
    btn.className = 'option-btn';
    btn.textContent = opt;
    btn.onclick = () => selectAnswer(i, btn);
    optionsEl.appendChild(btn);
  });
}

function selectAnswer(index, clickedBtn) {
  if (answered) return;
  answered = true;

  const q = shuffledQ[currentQ];
  const buttons = document.querySelectorAll('.option-btn');
  const feedbackEl = document.getElementById('feedback');
  const scoreBox = document.getElementById('scoreBox');
  const streakBox = document.getElementById('streakBox');
  const rect = clickedBtn.getBoundingClientRect();

  buttons.forEach((btn, i) => {
    btn.classList.add('disabled');
    if (i === q.correct) btn.classList.add('correct');
  });

  if (index === q.correct) {
    // CORRECT! GO CRAZY!
    streak++;
    if (streak > maxStreak) maxStreak = streak;
    const points = 10 + (streak > 1 ? streak * 5 : 0);
    score += points;

    clickedBtn.classList.add('correct');
    feedbackEl.innerHTML = `âœ… × ×›×•×Ÿ! ${streak > 1 ? `<b>ğŸ”¥ ×¨×¦×£ ${streak}! +${points} × ×§×•×“×•×ª!</b>` : ''}<br>${q.fact}`;
    feedbackEl.className = 'feedback correct-fb';

    // Update score with animation
    scoreBox.textContent = `ğŸ† ${score}`;
    scoreBox.classList.remove('bump');
    void scoreBox.offsetWidth;
    scoreBox.classList.add('bump');

    // Streak display
    if (streak >= 2) {
      streakBox.textContent = `ğŸ”¥ ×¨×¦×£: ${streak}`;
      streakBox.classList.add('active');
    }

    // EFFECTS!
    playCorrectSound();
    flashScreen('rgba(34,197,94,0.2)');
    spawnScoreFloat(points);
    spawnConfettiBurst(rect.left + rect.width/2, rect.top);
    spawnFlyingEmojis(['â­','ğŸ‰','ğŸ†','âœ¨','ğŸ‘‘','ğŸ­'], streak >= 3 ? 12 : 6);

    // Extra effects for streaks
    if (streak >= 3) {
      setTimeout(() => spawnFirework(window.innerWidth * 0.3, window.innerHeight * 0.3), 200);
      setTimeout(() => spawnFirework(window.innerWidth * 0.7, window.innerHeight * 0.4), 400);
    }
    if (streak >= 5) {
      setTimeout(() => spawnFirework(window.innerWidth * 0.5, window.innerHeight * 0.2), 300);
      spawnFlyingEmojis(['ğŸ”¥','ğŸ”¥','ğŸ”¥','ğŸ’¥','ğŸ’¥'], 8);
    }
  } else {
    // WRONG
    streak = 0;
    clickedBtn.classList.add('wrong');
    feedbackEl.textContent = `âŒ ×˜×¢×•×ª! ${q.fact}`;
    feedbackEl.className = 'feedback wrong-fb';
    streakBox.classList.remove('active');

    playWrongSound();
    flashScreen('rgba(239,68,68,0.15)');
    spawnWrongX();
    document.body.style.animation = 'none';
    void document.body.offsetWidth;
  }

  document.getElementById('nextBtn').classList.add('visible');
}

function nextQuestion() {
  currentQ++;
  if (currentQ >= shuffledQ.length) showResults();
  else showQuestion();
}

function showResults() {
  document.getElementById('questionCard').style.display = 'none';
  document.getElementById('progress').style.width = '100%';

  const total = shuffledQ.length * 10;
  const pct = Math.round((score / (shuffledQ.length * 15)) * 100);

  let emoji, title, msg;
  if (score >= shuffledQ.length * 12) { emoji = 'ğŸ†'; title = '×’××•×Ÿ ×”××’×™×œ×”!'; msg = '××“×”×™×! ××ª× ××•××—×™ ××’×™×œ×”!'; }
  else if (score >= shuffledQ.length * 8) { emoji = 'â­'; title = '×›×œ ×”×›×‘×•×“!'; msg = '×™×•×¤×™! ×™×“×¢ ××¨×©×™×!'; }
  else if (score >= shuffledQ.length * 5) { emoji = 'ğŸ‘'; title = '×œ× ×¨×¢!'; msg = '× ×¡×• ×©×•×‘ ×œ×©×™× ×—×“×©!'; }
  else { emoji = 'ğŸ“–'; title = '×™×© ××” ×œ×œ××•×“!'; msg = '×§×¨××• ××ª ×”××’×™×œ×” ×•× ×¡×• ×©×•×‘!'; }

  document.getElementById('resEmoji').textContent = emoji;
  document.getElementById('resTitle').textContent = title;
  document.getElementById('resScore').innerHTML = `${score} × ×§×•×“×•×ª | ×¨×¦×£ ×©×™×: ${maxStreak} ğŸ”¥`;
  document.getElementById('resMsg').textContent = msg;
  document.getElementById('results').classList.add('active');

  // Final celebration
  for (let i = 0; i < 5; i++) {
    setTimeout(() => spawnFirework(Math.random()*window.innerWidth, Math.random()*window.innerHeight*0.7), i * 300);
  }
  spawnFlyingEmojis(['ğŸ‰','ğŸ†','â­','ğŸ­','ğŸ‘‘'], 15);
}

function shareResult() {
  const text = `ğŸ­ *×—×™×“×•×Ÿ ××’×™×œ×ª ××¡×ª×¨*\n\n×§×™×‘×œ×ª×™ ${score} × ×§×•×“×•×ª!\nğŸ”¥ ×¨×¦×£ ×©×™×: ${maxStreak}\n\n× ×¡×• ×’×!\n${window.location.href.replace('/games/trivia.html', '')}`;
  window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
}

startQuiz();
</script>
</body>
</html>
